# Configuração básica do Apache
Options -Indexes
ServerSignature Off

# Definir UTF-8 como charset padrão
AddDefaultCharset UTF-8

# Proteção contra acesso direto a arquivos PHP internos
<FilesMatch "^(database|calculator|openai|mercadopago|generator)\.php$">
  Order Deny,Allow
  Deny from all
</FilesMatch>

# Proteção contra acesso a arquivos de log e temporários
<FilesMatch "\.(log|json|db|sqlite)$">
  Order Deny,Allow
  Deny from all
</FilesMatch>

# Negar acesso a diretórios sensíveis
<FilesMatch "^(logs|temp|pdfs|database)/">
  Order Deny,Allow
  Deny from all
</FilesMatch>

# Definir tipo de conteúdo para JavaScript
<FilesMatch "\.js$">
  ForceType application/javascript
</FilesMatch>

# Definir tipo de conteúdo para CSS
<FilesMatch "\.css$">
  ForceType text/css
</FilesMatch>

# Definir regras de reescrita se necessário
<IfModule mod_rewrite.c>
  RewriteEngine On

  # Redirecionar HTTP para HTTPS (descomente para ambiente de produção)
  # RewriteCond %{HTTPS} off
  # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  # Redirecionar www para não-www (descomente para ambiente de produção)
  # RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
  # RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [L,R=301]

  # Manter as URLs de retorno do Mercado Pago
  RewriteRule ^api/checkout/(success|failure|pending)\.php$ - [L]

  # Manter o webhook do Mercado Pago
  RewriteRule ^api/checkout/webhook\.php$ - [L]

  # Manter a API principal
  RewriteRule ^api/api\.php$ - [L]

  # Redirecionar todas as outras URLs de API para a API principal
  RewriteRule ^api/(.*)$ api/api.php [L]
</IfModule>

# Comprimir arquivos para melhorar desempenho
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

# Definir cabeçalhos de cache para arquivos estáticos
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# Definir headers de segurança
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-XSS-Protection "1; mode=block"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  # Descomente para ambiente de produção
  # Header set Content-Security-Policy "default-src 'self'; script-src 'self' https://sdk.mercadopago.com https://cdn.tailwindcss.com https://unpkg.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' data:; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self' https://api.mercadopago.com;"
</IfModule>